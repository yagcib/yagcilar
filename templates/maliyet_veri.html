{% extends "base_layout.html" %}

{% block title %}Maliyet Verileri - Yagcilar Manufacturing{% endblock %}

{% block head %}
<style>
    .badge-success {
        background-color: #28a745;
        color: white;
    }
    .badge-danger {
        background-color: #dc3545;
        color: white;
    }
    .action-buttons .btn {
        margin-right: 5px;
    }
    .btn-maliyet {
        background-color: #6610f2;
        color: white;
    }
    .btn-maliyet:hover {
        background-color: #520dc2;
        color: white;
    }
</style>
{% endblock %}

{% block content %}
<!-- "Maliyet Verileri" başlığının hemen altına proje bilgisi ekleyin -->
<div class="card-header bg-primary text-white">
    <div class="d-flex justify-content-between align-items-center">
        <h5 class="mb-0">
            <i class="fas fa-file-invoice-dollar"></i> Maliyet Verileri
            <span class="badge bg-warning text-dark ms-2">Sadece Projeler</span>
        </h5>

    </div>
</div>
    <div class="card-body">
        <p class="text-muted">
            <i class="fas fa-info-circle"></i> Bu sayfada satış kayıtlarını görüntüleyebilir ve maliyet bilgilerini ekleyebilirsiniz.
        </p>

        <table id="salesTable" class="table table-striped table-bordered table-hover" style="width:100%">
            <!-- Tabloya bir "Proje" sütunu ekleyin -->
<thead class="table-dark">
    <tr>
        <th>Proje</th>
        <th>İş Emri No</th>
        <th>Cari</th>
        <th>Sipariş Tarihi</th>
        <th>Teslim Tarihi</th>
        <th>Brüt Kg</th>
        <th>Net Kg</th>
        <th>Satış Tutarı (₺)</th>
        <th>Maliyet Tutarı (₺)</th>
        <th>Durum</th>
        <th>İşlemler</th>
    </tr>
</thead>
            <tbody>
    {% for item in sales_data %}
    {% if item.is_proje %}
    <tr>
        <td><span class="badge bg-success"><i class="fas fa-check"></i> Proje</span></td>
        <td>{{ item.is_emri_no }}</td>
        <td>{{ item.cari }}</td>
        <td>{{ item.siparis_tarihi }}</td>
        <td>{{ item.teslim_tarihi }}</td>
        <td>{{ "%.2f"|format(item.brut_kg) }}</td>
        <td>{{ "%.2f"|format(item.net_kg) }}</td>
        <td>{{ "%.2f"|format(item.satis_tutari) }} ₺</td>
        <td>{{ "%.2f"|format(item.maliyet_tutari) if item.maliyet_girildi else "-" }} ₺</td>
        <td>
            {% if item.maliyet_girildi %}
                <span class="badge badge-success">Maliyet Girildi</span>
            {% else %}
                <span class="badge badge-danger">Maliyet Girilmedi</span>
            {% endif %}
        </td>
        <td class="action-buttons">
            <a href="{{ url_for('maliyet_veri_details', sale_id=item.sale_id) }}" class="btn btn-sm btn-maliyet">
                <i class="fas fa-calculator"></i> Maliyet Ekle
            </a>
        </td>
    </tr>
        {% endif %}
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    $(document).ready(function() {
        $('#salesTable').DataTable({
            "responsive": true,
            "order": [[2, "desc"]], // Sort by Sipariş Tarihi (desc)
            "language": {
                "url": "//cdn.datatables.net/plug-ins/1.11.5/i18n/tr.json"
            },
            "pageLength": 50,
            "lengthMenu": [[10, 25, 50, 100, -1], [10, 25, 50, 100, "Tümü"]],
            "dom": 'Bfrtip',
            "buttons": [
                'copy', 'excel', 'pdf', 'print'
            ]
        });
    });
</script>
{% endblock %}